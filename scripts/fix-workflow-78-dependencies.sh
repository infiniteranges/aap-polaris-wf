#!/bin/bash
#
# Fix Workflow 78 Node Dependencies
# This script provides instructions and attempts to fix node dependencies
#

WORKFLOW_ID=78
AAP_URL="https://sc-awx.r53.infiniteranges.com"
AAP_USER="admin"
AAP_PASSWORD="IV1fD5JwqGJVuz4FjefWZKngVQNNpicg"

echo "ğŸ”§ Fixing Workflow 78 Node Dependencies"
echo "======================================================================"
echo ""
echo "âš ï¸  Note: Workflow node dependencies are best configured via AAP UI"
echo "   The API may not properly set up convergence rules."
echo ""
echo "ğŸ“‹ Correct Workflow Structure:"
echo ""
echo "   START"
echo "     â†“"
echo "   clone-repo"
echo "     â†“"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â†“             â†“"
echo "   install    create-config"
echo "   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜"
echo "         â†“ (converge)"
echo "      terraform-plan"
echo "         â†“"
echo "      terraform-apply"
echo "         â†“"
echo "      apply-callback"
echo ""
echo "ğŸ”— Configure in AAP UI:"
echo "   ${AAP_URL}/#/templates/workflow_job_template/${WORKFLOW_ID}/visualizer"
echo ""
echo "ğŸ“‹ Steps:"
echo "   1. Open workflow visualizer"
echo "   2. Delete all node connections"
echo "   3. Connect nodes in this order:"
echo "      - START â†’ clone-repo"
echo "      - clone-repo â†’ install-terraform"
echo "      - clone-repo â†’ create-config"
echo "      - install-terraform â†’ terraform-plan"
echo "      - create-config â†’ terraform-plan (set convergence: ALL)"
echo "      - terraform-plan â†’ terraform-apply"
echo "      - terraform-apply â†’ apply-callback"
echo ""
echo "ğŸ’¡ The convergence rule ensures terraform-plan waits for BOTH"
echo "   install-terraform AND create-config to complete."
